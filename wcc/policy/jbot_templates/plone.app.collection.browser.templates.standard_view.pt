<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

    <body>
        <div metal:fill-slot="content-core">
            <metal:block define-macro="content-core"
                         tal:define="kssClassesView context/@@kss_field_decorator_view;
                                     getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
                                     templateId template/getId">
                <div metal:define-macro="text-field-view"
                    id="parent-fieldname-text" class="stx"
                    tal:define="kss_class python:getKssClasses('text',
                                templateId=templateId, macro='text-field-view');
                                has_text exists:context/aq_explicit/getText;
                                text python:has_text and here.getText() or ''"
                    tal:condition="text"
                    tal:attributes="class python:context.Format() in ('text/structured', 'text/x-rst', ) and 'stx' + kss_class or 'plain' + kss_class">
                   <div metal:define-slot="inside" tal:replace="structure text">The body</div>
               </div>
                <metal:listingmacro define-macro="listing">
                    <tal:results define="b_start python:request.get('b_start', 0);
                             batch python:context.results(b_start=b_start);
                             portal_registry context/portal_registry|nothing;
                             use_view_action python:portal_registry.get('plone.types_use_view_action_in_listings', []);
                             isAnon context/@@plone_portal_state/anonymous;
                             normalizeString nocall: context/plone_utils/normalizeString;
                             toLocalizedTime nocall: context/@@plone/toLocalizedTime;
                             show_about_registry python:portal_registry.get('plone.allow_anon_views_about', []) if portal_registry else [];
                             show_about python:not isAnon or show_about_registry;
                             navigation_root_url context/@@plone_portal_state/navigation_root_url;
                             pas_member context/@@pas_member;">
                        
                        <tal:listing condition="batch">
                            
                            <tal:custom condition="here/customViewFields|nothing"
                                        define="vocab python:here.listMetaDataFields(False)">
                                
                                <table class="listing"
                                        summary="Content listing"
                                        i18n:attributes="summary summary_content_listing;"
                                        tal:define="fields here/customViewFields; has_start_end python: 'start' in fields and 'end' in fields">
                                    
                                    <thead>
                                        <tal:if tal:condition="has_start_end">
                                            <tr>
                                              <tal:entry tal:repeat="field here/customViewFields">
                                               <tal:block tal:define="field_title python: vocab.getValue(field, field)" tal:condition="python: field not in ('start', 'end')">
                                                <th tal:content="python:vocab.getValue(field, field)"
                                                    i18n:translate=""/>
                                                
                                               </tal:block>
                                              </tal:entry>
                                              <th colspan='2' style='width:30%'>
                                               Date Period
                                              </th>
                                            </tr>
                                        </tal:if>
                                        <tal:if tal:condition="not: has_start_end">
                                            <tr>
                                             <tal:entry tal:repeat="field here/customViewFields">
                                              <th tal:content="python:vocab.getValue(field, field)"
                                                       i18n:translate=""/>
                                             </tal:entry>
                                            </tr>
                                        </tal:if>
                                    </thead>
                                    
                                    <tbody>
                                        <tal:brain tal:repeat="obj batch">
                                        <tr tal:define="oddrow repeat/obj/odd;">
                                          <tal:if tal:condition="has_start_end">
                                            <tal:fields repeat="field here/customViewFields"
                                                        define="normalizeString nocall:context/@@plone/normalizeString;
                                                                url obj/getURL;
                                                                obj_type obj/portal_type;
                                                                obj_description obj/Description;
                                                                obj_typeinfo python: here.portal_types.getTypeInfo(obj_type);
                                                                obj_icon python:plone_view.getIcon(obj);
                                                                obj_wf_state obj/review_state|python: wtool.getInfoFor(obj, 'review_state', '');
                                                                obj_wf_state_class python:'state-' + normalizeString(obj_wf_state);
                                                                obj_ct_class python:'contenttype-' + normalizeString(obj_type);
                                                                title_or_id obj/pretty_title_or_id;
                                                                ">
                                            <tal:block define="value python: getattr(obj, field, None)">
                
                                                <td tal:condition="python: field not in ('Title','start','end','CreationDate','EffectiveDate','ExpirationDate','ModificationDate')"
                                                    tal:content="value"
                                                    i18n:translate=""/>
    
                                                <td tal:condition="python: field in ('CreationDate','EffectiveDate','ExpirationDate','ModificationDate')"
                                                    tal:content="python:toLocalizedTime(value)"
                                                    i18n:translate=""/>

                                                <td tal:condition="python: field == 'Title'">
                                                    <a href="#" tal:attributes="href url;
                                                                                title obj_description;">
                                                        <img tal:replace="structure obj_icon/html_tag|nothing" />
                                                    </a>
                                                    <a href="#"
                                                       tal:condition="python: obj.portal_type != 'Link'"
                                                       tal:attributes="href url;
                                                                       class string:${obj_wf_state_class} ${obj_ct_class};
                                                                       title obj_description;"
                                                       tal:content="obj/title">
                                                        Item Title
                                                    </a>
                
                                                    <a href="#"
                                                       tal:condition="python: obj.portal_type == 'Link'"
                                                       tal:attributes="href obj/getRemoteUrl;
                                                                       class string:${obj_wf_state_class} ${obj_ct_class} link-plain;
                                                                       title obj_description;"
                                                       class="link-plain"
                                                       tal:content="obj/title" />
                
                                                </td>
                                            </tal:block>
                                            </tal:fields>
                                            <td tal:define="item_start obj/start|nothing;
                                                            item_end obj/end|nothing;
                                                            start_month item_start/month;
                                                            end_month item_end/month;
                                                            start_year item_start/year;
                                                            end_year item_end/year;
                                                            item_samedate python: True if item_start == item_end else False;
                                                            item_samemonth python: start_month == end_month;
                                                            item_sameyear python: start_year == end_year;
                                                            ">
                                              <span tal:condition="python: item_samedate">
                                                   <span tal:content="python:toLocalizedTime(item_start)">date</span>
                                              </span>
                                              
                                              <span tal:condition="python: item_samemonth and not item_samedate and item_sameyear">
                                                   <span tal:content="python: toLocalizedTime(item_start).split()[0]">date</span>
                                                  -
                                                  <span tal:content="python: toLocalizedTime(item_end)">date</span>
                      
                                              </span>
                                              
                                              <span tal:condition="python: not item_samemonth and not item_samedate and item_sameyear">
                                                   <span tal:content="python: ' '.join(toLocalizedTime(item_start).split()[0:-1])">date</span>
                                                  -
                                                  <span tal:content="python: toLocalizedTime(item_end)">date</span>
                      
                                              </span>
                                              
                                              <span tal:condition="python: not item_sameyear">
                                                   <span tal:content="python:toLocalizedTime(item_start)">date</span>
                                                  -
                                                  <span tal:content="python: toLocalizedTime(item_end)">date</span>
                      
                                              </span>
                                            </td>
                                          </tal:if>
                                          
                                          <tal:if tal:condition="not: has_start_end">
                                            <tal:fields repeat="field here/customViewFields"
                                                        define="normalizeString nocall:context/@@plone/normalizeString;
                                                                url obj/getURL;
                                                                obj_type obj/portal_type;
                                                                obj_description obj/Description;
                                                                obj_typeinfo python: here.portal_types.getTypeInfo(obj_type);
                                                                obj_icon python:plone_view.getIcon(obj);
                                                                obj_wf_state obj/review_state|python: wtool.getInfoFor(obj, 'review_state', '');
                                                                obj_wf_state_class python:'state-' + normalizeString(obj_wf_state);
                                                                obj_ct_class python:'contenttype-' + normalizeString(obj_type);
                                                                title_or_id obj/pretty_title_or_id;
                                                                ">
                                              <tal:block define="value python: getattr(obj, field, None)">
                                                <td tal:condition="python: field not in ('Title','start','end','CreationDate','EffectiveDate','ExpirationDate','ModificationDate')"
                                                    tal:content="value"
                                                    i18n:translate=""/>
                                                
                                                <td tal:condition="python: field in ('CreationDate','EffectiveDate','ExpirationDate','ModificationDate')"
                                                    tal:content="python:toLocalizedTime(value)"
                                                    i18n:translate=""/>
                                                
                                                <td tal:condition="python: field == 'Title'">
                                                    <a href="#" tal:attributes="href url;
                                                                                title obj_description;">
                                                        <img tal:replace="structure obj_icon/html_tag|nothing" />
                                                    </a>
                                                    <a href="#"
                                                       tal:condition="python: obj.portal_type != 'Link'"
                                                       tal:attributes="href url;
                                                                       class string:${obj_wf_state_class} ${obj_ct_class};
                                                                       title obj_description;"
                                                       tal:content="obj/title">
                                                        Item Title
                                                    </a>
                
                                                    <a href="#"
                                                       tal:condition="python: obj.portal_type == 'Link'"
                                                       tal:attributes="href obj/getRemoteUrl;
                                                                       class string:${obj_wf_state_class} ${obj_ct_class} link-plain;
                                                                       title obj_description;"
                                                       class="link-plain"
                                                       tal:content="obj/title" />
                
                                                </td>
                                                
                                                <td tal:condition="python: field in ('start', 'end')">
                                                  <span tal:content="python:toLocalizedTime(value)">date</span>
                                                </td>
                                                
                                                
                                              </tal:block>
                                              
                                            </tal:fields>
                                          </tal:if>
                                        </tr>
                                        </tal:brain>
                                     </tbody>
                                </table>
                            </tal:custom>
                        </tal:listing>
                    </tal:results>
                </metal:listingmacro>
            </metal:block>
        </div>
    </body>
</html>
